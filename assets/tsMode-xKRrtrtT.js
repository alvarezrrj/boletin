var L=function(n,o,t,i){function c(e){return e instanceof t?e:new t(function(a){a(e)})}return new(t||(t=Promise))(function(e,a){function u(s){try{r(i.next(s))}catch(f){a(f)}}function l(s){try{r(i.throw(s))}catch(f){a(f)}}function r(s){s.done?e(s.value):c(s.value).then(u,l)}r((i=i.apply(n,o||[])).next())})},N=function(n,o){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,c,e,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(r){return function(s){return l([r,s])}}function l(r){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,c&&(e=r[0]&2?c.return:r[0]?c.throw||((e=c.return)&&e.call(c),0):c.next)&&!(e=e.call(c,r[1])).done)return e;switch(c=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,c=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=o.call(n,t)}catch(s){r=[6,s],c=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},K=function(){function n(o,t){var i=this;this._modeId=o,this._defaults=t,this._worker=null,this._idleCheckInterval=setInterval(function(){return i._checkIfIdle()},3e4),this._lastUsedTime=0,this._configChangeListener=this._defaults.onDidChange(function(){return i._stopWorker()}),this._updateExtraLibsToken=0,this._extraLibsChangeListener=this._defaults.onDidExtraLibsChange(function(){return i._updateExtraLibs()})}return n.prototype._stopWorker=function(){this._worker&&(this._worker.dispose(),this._worker=null),this._client=null},n.prototype.dispose=function(){clearInterval(this._idleCheckInterval),this._configChangeListener.dispose(),this._extraLibsChangeListener.dispose(),this._stopWorker()},n.prototype._updateExtraLibs=function(){return L(this,void 0,void 0,function(){var o,t;return N(this,function(i){switch(i.label){case 0:return this._worker?(o=++this._updateExtraLibsToken,[4,this._worker.getProxy()]):[2];case 1:return t=i.sent(),this._updateExtraLibsToken!==o?[2]:(t.updateExtraLibs(this._defaults.getExtraLibs()),[2])}})})},n.prototype._checkIfIdle=function(){if(this._worker){var o=this._defaults.getWorkerMaxIdleTime(),t=Date.now()-this._lastUsedTime;o>0&&t>o&&this._stopWorker()}},n.prototype._getClient=function(){var o=this;if(this._lastUsedTime=Date.now(),!this._client){this._worker=monaco.editor.createWebWorker({moduleId:"vs/language/typescript/tsWorker",label:this._modeId,createData:{compilerOptions:this._defaults.getCompilerOptions(),extraLibs:this._defaults.getExtraLibs()}});var t=this._worker.getProxy();this._defaults.getEagerModelSync()&&(t=t.then(function(i){return o._worker.withSyncedResources(monaco.editor.getModels().filter(function(c){return c.getModeId()===o._modeId}).map(function(c){return c.uri}))})),this._client=t}return this._client},n.prototype.getLanguageServiceWorker=function(){for(var o=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var c;return this._getClient().then(function(e){c=e}).then(function(e){return o._worker.withSyncedResources(t)}).then(function(e){return c})},n}(),v=function(){var n=function(o,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,c){i.__proto__=c}||function(i,c){for(var e in c)c.hasOwnProperty(e)&&(i[e]=c[e])},n(o,t)};return function(o,t){n(o,t);function i(){this.constructor=o}o.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),R=function(n,o,t,i){function c(e){return e instanceof t?e:new t(function(a){a(e)})}return new(t||(t=Promise))(function(e,a){function u(s){try{r(i.next(s))}catch(f){a(f)}}function l(s){try{r(i.throw(s))}catch(f){a(f)}}function r(s){s.done?e(s.value):c(s.value).then(u,l)}r((i=i.apply(n,o||[])).next())})},M=function(n,o){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,c,e,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(r){return function(s){return l([r,s])}}function l(r){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,c&&(e=r[0]&2?c.return:r[0]?c.throw||((e=c.return)&&e.call(c),0):c.next)&&!(e=e.call(c,r[1])).done)return e;switch(c=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,c=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=o.call(n,t)}catch(s){r=[6,s],c=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},I=monaco.Uri,P=monaco.Range,T;(function(n){n[n.None=0]="None",n[n.Block=1]="Block",n[n.Smart=2]="Smart"})(T||(T={}));function O(n,o,t){if(t===void 0&&(t=0),typeof n=="string")return n;if(n===void 0)return"";var i="";if(t){i+=o;for(var c=0;c<t;c++)i+="  "}if(i+=n.messageText,t++,n.next)for(var e=0,a=n.next;e<a.length;e++){var u=a[e];i+=O(u,o,t)}return i}function _(n){return n?n.map(function(o){return o.text}).join(""):""}var y=function(){function n(o){this._worker=o}return n.prototype._positionToOffset=function(o,t){var i=monaco.editor.getModel(o);return i.getOffsetAt(t)},n.prototype._offsetToPosition=function(o,t){var i=monaco.editor.getModel(o);return i.getPositionAt(t)},n.prototype._textSpanToRange=function(o,t){var i=this._offsetToPosition(o,t.start),c=this._offsetToPosition(o,t.start+t.length),e=i.lineNumber,a=i.column,u=c.lineNumber,l=c.column;return{startLineNumber:e,startColumn:a,endLineNumber:u,endColumn:l}},n}(),E=function(n){v(o,n);function o(t,i,c){var e=n.call(this,c)||this;e._defaults=t,e._selector=i,e._disposables=[],e._listener=Object.create(null);var a=function(r){if(r.getModeId()===i){var s,f=r.onDidChangeContent(function(){clearTimeout(s),s=setTimeout(function(){return e._doValidate(r.uri)},500)});e._listener[r.uri.toString()]={dispose:function(){f.dispose(),clearTimeout(s)}},e._doValidate(r.uri)}},u=function(r){monaco.editor.setModelMarkers(r,e._selector,[]);var s=r.uri.toString();e._listener[s]&&(e._listener[s].dispose(),delete e._listener[s])};e._disposables.push(monaco.editor.onDidCreateModel(a)),e._disposables.push(monaco.editor.onWillDisposeModel(u)),e._disposables.push(monaco.editor.onDidChangeModelLanguage(function(r){u(r.model),a(r.model)})),e._disposables.push({dispose:function(){for(var r=0,s=monaco.editor.getModels();r<s.length;r++){var f=s[r];u(f)}}});var l=function(){for(var r=0,s=monaco.editor.getModels();r<s.length;r++){var f=s[r];u(f),a(f)}};return e._disposables.push(e._defaults.onDidChange(l)),e._disposables.push(e._defaults.onDidExtraLibsChange(l)),monaco.editor.getModels().forEach(a),e}return o.prototype.dispose=function(){this._disposables.forEach(function(t){return t&&t.dispose()}),this._disposables=[]},o.prototype._doValidate=function(t){var i=this;this._worker(t).then(function(c){if(!monaco.editor.getModel(t))return null;var e=[],a=i._defaults.getDiagnosticsOptions(),u=a.noSyntaxValidation,l=a.noSemanticValidation;return u||e.push(c.getSyntacticDiagnostics(t.toString())),l||e.push(c.getSemanticDiagnostics(t.toString())),Promise.all(e)}).then(function(c){if(!c||!monaco.editor.getModel(t))return null;var e=c.reduce(function(a,u){return u.concat(a)},[]).map(function(a){return i._convertDiagnostics(t,a)});monaco.editor.setModelMarkers(monaco.editor.getModel(t),i._selector,e)}).then(void 0,function(c){console.error(c)})},o.prototype._convertDiagnostics=function(t,i){var c=this._offsetToPosition(t,i.start),e=c.lineNumber,a=c.column,u=this._offsetToPosition(t,i.start+i.length),l=u.lineNumber,r=u.column;return{severity:monaco.MarkerSeverity.Error,startLineNumber:e,startColumn:a,endLineNumber:l,endColumn:r,message:O(i.messageText,`
`)}},o}(y),F=function(n){v(o,n);function o(){return n!==null&&n.apply(this,arguments)||this}return Object.defineProperty(o.prototype,"triggerCharacters",{get:function(){return["."]},enumerable:!0,configurable:!0}),o.prototype.provideCompletionItems=function(t,i,c,e){var a=t.getWordUntilPosition(i),u=new P(i.lineNumber,a.startColumn,i.lineNumber,a.endColumn),l=t.uri,r=this._positionToOffset(l,i);return this._worker(l).then(function(s){return s.getCompletionsAtPosition(l.toString(),r)}).then(function(s){if(s){var f=s.entries.map(function(g){var p=u;if(g.replacementSpan){var h=t.getPositionAt(g.replacementSpan.start),b=t.getPositionAt(g.replacementSpan.start+g.replacementSpan.length);p=new P(h.lineNumber,h.column,b.lineNumber,b.column)}return{uri:l,position:i,range:p,label:g.name,insertText:g.name,sortText:g.sortText,kind:o.convertKind(g.kind)}});return{suggestions:f}}})},o.prototype.resolveCompletionItem=function(t,i,c,e){var a=this,u=c,l=u.uri,r=u.position;return this._worker(l).then(function(s){return s.getCompletionEntryDetails(l.toString(),a._positionToOffset(l,r),u.label)}).then(function(s){return s?{uri:l,position:r,label:s.name,kind:o.convertKind(s.kind),detail:_(s.displayParts),documentation:{value:_(s.documentation)}}:u})},o.convertKind=function(t){switch(t){case m.primitiveType:case m.keyword:return monaco.languages.CompletionItemKind.Keyword;case m.variable:case m.localVariable:return monaco.languages.CompletionItemKind.Variable;case m.memberVariable:case m.memberGetAccessor:case m.memberSetAccessor:return monaco.languages.CompletionItemKind.Field;case m.function:case m.memberFunction:case m.constructSignature:case m.callSignature:case m.indexSignature:return monaco.languages.CompletionItemKind.Function;case m.enum:return monaco.languages.CompletionItemKind.Enum;case m.module:return monaco.languages.CompletionItemKind.Module;case m.class:return monaco.languages.CompletionItemKind.Class;case m.interface:return monaco.languages.CompletionItemKind.Interface;case m.warning:return monaco.languages.CompletionItemKind.File}return monaco.languages.CompletionItemKind.Property},o}(y),W=function(n){v(o,n);function o(){var t=n!==null&&n.apply(this,arguments)||this;return t.signatureHelpTriggerCharacters=["(",","],t}return o.prototype.provideSignatureHelp=function(t,i,c){var e=this,a=t.uri;return this._worker(a).then(function(u){return u.getSignatureHelpItems(a.toString(),e._positionToOffset(a,i))}).then(function(u){if(u){var l={activeSignature:u.selectedItemIndex,activeParameter:u.argumentIndex,signatures:[]};return u.items.forEach(function(r){var s={label:"",parameters:[]};s.label+=_(r.prefixDisplayParts),r.parameters.forEach(function(f,g,p){var h=_(f.displayParts),b={label:h,documentation:_(f.documentation)};s.label+=h,s.parameters.push(b),g<p.length-1&&(s.label+=_(r.separatorDisplayParts))}),s.label+=_(r.suffixDisplayParts),l.signatures.push(s)}),{value:l,dispose:function(){}}}})},o}(y),V=function(n){v(o,n);function o(){return n!==null&&n.apply(this,arguments)||this}return o.prototype.provideHover=function(t,i,c){var e=this,a=t.uri;return this._worker(a).then(function(u){return u.getQuickInfoAtPosition(a.toString(),e._positionToOffset(a,i))}).then(function(u){if(u){var l=_(u.documentation),r=u.tags?u.tags.map(function(f){var g="*@"+f.name+"*";return f.text?g+(f.text.match(/\r\n|\n/g)?` 
`+f.text:" - "+f.text):g}).join(`  

`):"",s=_(u.displayParts);return{range:e._textSpanToRange(a,u.textSpan),contents:[{value:"```js\n"+s+"\n```\n"},{value:l+(r?`

`+r:"")}]}}})},o}(y),H=function(n){v(o,n);function o(){return n!==null&&n.apply(this,arguments)||this}return o.prototype.provideDocumentHighlights=function(t,i,c){var e=this,a=t.uri;return this._worker(a).then(function(u){return u.getOccurrencesAtPosition(a.toString(),e._positionToOffset(a,i))}).then(function(u){if(u)return u.map(function(l){return{range:e._textSpanToRange(a,l.textSpan),kind:l.isWriteAccess?monaco.languages.DocumentHighlightKind.Write:monaco.languages.DocumentHighlightKind.Text}})})},o}(y),B=function(n){v(o,n);function o(){return n!==null&&n.apply(this,arguments)||this}return o.prototype.provideDefinition=function(t,i,c){var e=this,a=t.uri;return this._worker(a).then(function(u){return u.getDefinitionAtPosition(a.toString(),e._positionToOffset(a,i))}).then(function(u){if(u){for(var l=[],r=0,s=u;r<s.length;r++){var f=s[r],g=I.parse(f.fileName);monaco.editor.getModel(g)&&l.push({uri:g,range:e._textSpanToRange(g,f.textSpan)})}return l}})},o}(y),j=function(n){v(o,n);function o(){return n!==null&&n.apply(this,arguments)||this}return o.prototype.provideReferences=function(t,i,c,e){var a=this,u=t.uri;return this._worker(u).then(function(l){return l.getReferencesAtPosition(u.toString(),a._positionToOffset(u,i))}).then(function(l){if(l){for(var r=[],s=0,f=l;s<f.length;s++){var g=f[s],p=I.parse(g.fileName);monaco.editor.getModel(p)&&r.push({uri:p,range:a._textSpanToRange(p,g.textSpan)})}return r}})},o}(y),U=function(n){v(o,n);function o(){return n!==null&&n.apply(this,arguments)||this}return o.prototype.provideDocumentSymbols=function(t,i){var c=this,e=t.uri;return this._worker(e).then(function(a){return a.getNavigationBarItems(e.toString())}).then(function(a){if(a){var u=function(r,s,f){var g={name:s.text,detail:"",kind:d[s.kind]||monaco.languages.SymbolKind.Variable,range:c._textSpanToRange(e,s.spans[0]),selectionRange:c._textSpanToRange(e,s.spans[0]),tags:[],containerName:f};if(s.childItems&&s.childItems.length>0)for(var p=0,h=s.childItems;p<h.length;p++){var b=h[p];u(r,b,g.name)}r.push(g)},l=[];return a.forEach(function(r){return u(l,r)}),l}})},o}(y),m=function(){function n(){}return n.unknown="",n.keyword="keyword",n.script="script",n.module="module",n.class="class",n.interface="interface",n.type="type",n.enum="enum",n.variable="var",n.localVariable="local var",n.function="function",n.localFunction="local function",n.memberFunction="method",n.memberGetAccessor="getter",n.memberSetAccessor="setter",n.memberVariable="property",n.constructorImplementation="constructor",n.callSignature="call",n.indexSignature="index",n.constructSignature="construct",n.parameter="parameter",n.typeParameter="type parameter",n.primitiveType="primitive type",n.label="label",n.alias="alias",n.const="const",n.let="let",n.warning="warning",n}(),d=Object.create(null);d[m.module]=monaco.languages.SymbolKind.Module;d[m.class]=monaco.languages.SymbolKind.Class;d[m.enum]=monaco.languages.SymbolKind.Enum;d[m.interface]=monaco.languages.SymbolKind.Interface;d[m.memberFunction]=monaco.languages.SymbolKind.Method;d[m.memberVariable]=monaco.languages.SymbolKind.Property;d[m.memberGetAccessor]=monaco.languages.SymbolKind.Property;d[m.memberSetAccessor]=monaco.languages.SymbolKind.Property;d[m.variable]=monaco.languages.SymbolKind.Variable;d[m.const]=monaco.languages.SymbolKind.Variable;d[m.localVariable]=monaco.languages.SymbolKind.Variable;d[m.variable]=monaco.languages.SymbolKind.Variable;d[m.function]=monaco.languages.SymbolKind.Function;d[m.localFunction]=monaco.languages.SymbolKind.Function;var k=function(n){v(o,n);function o(){return n!==null&&n.apply(this,arguments)||this}return o._convertOptions=function(t){return{ConvertTabsToSpaces:t.insertSpaces,TabSize:t.tabSize,IndentSize:t.tabSize,IndentStyle:T.Smart,NewLineCharacter:`
`,InsertSpaceAfterCommaDelimiter:!0,InsertSpaceAfterSemicolonInForStatements:!0,InsertSpaceBeforeAndAfterBinaryOperators:!0,InsertSpaceAfterKeywordsInControlFlowStatements:!0,InsertSpaceAfterFunctionKeywordForAnonymousFunctions:!0,InsertSpaceAfterOpeningAndBeforeClosingNonemptyParenthesis:!1,InsertSpaceAfterOpeningAndBeforeClosingNonemptyBrackets:!1,InsertSpaceAfterOpeningAndBeforeClosingTemplateStringBraces:!1,PlaceOpenBraceOnNewLineForControlBlocks:!1,PlaceOpenBraceOnNewLineForFunctions:!1}},o.prototype._convertTextChanges=function(t,i){return{text:i.newText,range:this._textSpanToRange(t,i.span)}},o}(y),z=function(n){v(o,n);function o(){return n!==null&&n.apply(this,arguments)||this}return o.prototype.provideDocumentRangeFormattingEdits=function(t,i,c,e){var a=this,u=t.uri;return this._worker(u).then(function(l){return l.getFormattingEditsForRange(u.toString(),a._positionToOffset(u,{lineNumber:i.startLineNumber,column:i.startColumn}),a._positionToOffset(u,{lineNumber:i.endLineNumber,column:i.endColumn}),k._convertOptions(c))}).then(function(l){if(l)return l.map(function(r){return a._convertTextChanges(u,r)})})},o}(k),G=function(n){v(o,n);function o(){return n!==null&&n.apply(this,arguments)||this}return Object.defineProperty(o.prototype,"autoFormatTriggerCharacters",{get:function(){return[";","}",`
`]},enumerable:!0,configurable:!0}),o.prototype.provideOnTypeFormattingEdits=function(t,i,c,e,a){var u=this,l=t.uri;return this._worker(l).then(function(r){return r.getFormattingEditsAfterKeystroke(l.toString(),u._positionToOffset(l,i),c,k._convertOptions(e))}).then(function(r){if(r)return r.map(function(s){return u._convertTextChanges(l,s)})})},o}(k),J=function(n){v(o,n);function o(){return n!==null&&n.apply(this,arguments)||this}return o.prototype.provideRenameEdits=function(t,i,c,e){return R(this,void 0,void 0,function(){var a,u,l,r,s,f,g,p,h,b,S,x;return M(this,function(w){switch(w.label){case 0:return a=t.uri,u=a.toString(),l=this._positionToOffset(a,i),[4,this._worker(a)];case 1:return r=w.sent(),[4,r.getRenameInfo(u,l,{allowRenameOfImportPath:!1})];case 2:if(s=w.sent(),s.canRename===!1)return[2,{edits:[],rejectReason:s.localizedErrorMessage}];if(s.fileToRename!==void 0)throw new Error("Renaming files is not supported.");return[4,r.findRenameLocations(u,l,!1,!1,!1)];case 3:for(f=w.sent(),g={},p=[],h=0,b=f;h<b.length;h++)S=b[h],S.fileName in g||(x={edits:[],resource:monaco.Uri.parse(S.fileName)},g[S.fileName]=x,p.push(x)),g[S.fileName].edits.push({range:this._textSpanToRange(a,S.textSpan),text:c});return[2,{edits:p}]}})})},o}(y),C,A;function Q(n){A=D(n,"typescript")}function $(n){C=D(n,"javascript")}function q(){return new Promise(function(n,o){if(!C)return o("JavaScript not registered!");n(C)})}function X(){return new Promise(function(n,o){if(!A)return o("TypeScript not registered!");n(A)})}function D(n,o){var t=new K(o,n),i=function(c){for(var e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];return t.getLanguageServiceWorker.apply(t,[c].concat(e))};return monaco.languages.registerCompletionItemProvider(o,new F(i)),monaco.languages.registerSignatureHelpProvider(o,new W(i)),monaco.languages.registerHoverProvider(o,new V(i)),monaco.languages.registerDocumentHighlightProvider(o,new H(i)),monaco.languages.registerDefinitionProvider(o,new B(i)),monaco.languages.registerReferenceProvider(o,new j(i)),monaco.languages.registerDocumentSymbolProvider(o,new U(i)),monaco.languages.registerDocumentRangeFormattingEditProvider(o,new z(i)),monaco.languages.registerOnTypeFormattingEditProvider(o,new G(i)),monaco.languages.registerRenameProvider(o,new J(i)),new E(n,o,i),i}export{q as getJavaScriptWorker,X as getTypeScriptWorker,$ as setupJavaScript,Q as setupTypeScript};
